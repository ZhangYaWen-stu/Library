<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.library.mapper.BorrowMapper">
    <resultMap id="borrowMap" type="com.library.pojo.Borrow">
        <id column="BorrowID" property="borrowId"/>
        <result property="borrowTime" column="BorrowTime"/>
        <result property="dueTime" column="DueTime"/>
        <result property="returnTime" column="ReturnTime"/>
        <result property="librarianJobNumber" column="LGH"/>
        <result property="bookId" column="BookID"/>
        <result property="readerId" column="ReaderID"/>
        <result property="state" column="state"/>
    </resultMap>

    <resultMap id="borrowMapAll" type="com.library.pojo.BorrowList">
        <id column="BorrowID" property="borrowId"/>
        <result property="borrowTime" column="BorrowTime"/>
        <result property="dueTime" column="DueTime"/>
        <result property="returnTime" column="ReturnTime"/>
        <result property="librarianJobNumber" column="LGH"/>
        <result property="bookId" column="BookID"/>
        <result property="readerId" column="ReaderID"/>
        <result property="state" column="state"/>
        <result property="bookName" column="BookName"/>
        <result property="userName" column="Username"/>
    </resultMap>

    <update id="updateBorrowList">
        update borrowing
        <set>
            <if test="borrowTime != null">
                BorrowTime = #{borrowTime},
            </if>
            <if test="dueTime != null">
                DueTime = #{dueTime},
            </if>
            <if test="returnTime != null">
                ReturnTime = #{returnTime},
            </if>
            <if test="librarianJobNumber != null">
                LGH = #{librarianJobNumber},
            </if>
            <if test="readerId != null">
                ReaderID = #{readerId},
            </if>
            <if test="bookId != null">
                BookID = #{bookId},
            </if>
            <if test="state != null">
                state = #{state},
            </if>
        </set>
        where BorrowID = #{borrowId}
    </update>
    <delete id="deleteBorrowList">
        delete from borrowing
        <where>
            <if test="borrowId != null">
                BorrowId = #{borrowId}
            </if>
            <if test="borrowTime != null">
                and BorrowTime = #{borrowTime}
            </if>
            <if test="dueTime != null">
                and DueTime = #{dueTime}
            </if>
            <if test="returnTime != null">
                and ReturnTime = #{returnTime}
            </if>
            <if test="librarianJobNumber != null">
                and LGH = #{librarianJobNumber}
            </if>
            <if test="readerId != null">
                and ReaderID = #{readerId}
            </if>
            <if test="bookId != null">
                and BookID = #{bookId}
            </if>
            <if test="state != null">
                and state = #{state}
            </if>
        </where>
    </delete>
    <select id="getBorrow" resultMap="borrowMap">
        select * from borrowing
        where BorrowID = #{borrowId}
        <if test="readerId != null">
            and ReaderID = #{readerId}
        </if>
    </select>
    <select id="getBorrowList" resultMap="borrowMap">
        select * from borrowing
        <where>
            <if test="borrowId != null">
                BorrowId = #{borrowId}
            </if>
            <if test="borrowTime != null">
                and BorrowTime = #{borrowTime}
            </if>
            <if test="dueTime != null">
                and DueTime = #{dueTime}
            </if>
            <if test="returnTime != null">
                and ReturnTime = #{returnTime}
            </if>
            <if test="librarianJobNumber != null">
                and LGH = #{librarianJobNumber}
            </if>
            <if test="readerId != null">
                and ReaderID = #{readerId}
            </if>
            <if test="bookId != null">
                and BookID = #{bookId}
            </if>
            <if test="state != null">
                and state = #{state}
            </if>
        </where>
    </select>
    <select id="getBorrowListAll" resultMap="borrowMapAll">
        select borrowing.BorrowID as BorrowID, borrowing.ReaderID as ReaderID,
               borrowing.BookID as BookID, borrowing.BorrowTime as BorrowTime,
               borrowing.DueTime as DueTime, borrowing.ReturnTime as ReturnTime,
               borrowing.LGH as LGH, borrowing.state as state,
               reader.Username as Username, bookcatalog.BookName as BookName
        from borrowing, reader, bookcatalog, bookinfo
        where
            borrowing.BookID = bookinfo.ID and
            borrowing.ReaderID = reader.ID and
            bookinfo.ISBN = bookcatalog.ISBN
            <if test="borrowId != null">
                and borrowing.BorrowId = #{borrowId}
            </if>
            <if test="borrowTime != null">
                and borrowing.BorrowTime = #{borrowTime}
            </if>
            <if test="dueTime != null">
                and borrowing.DueTime = #{dueTime}
            </if>
            <if test="returnTime != null">
                and borrowing.ReturnTime = #{returnTime}
            </if>
            <if test="librarianJobNumber != null">
                and borrowing.LGH = #{librarianJobNumber}
            </if>
            <if test="readerId != null">
                and borrowing.ReaderID = #{readerId}
            </if>
            <if test="bookId != null">
                and borrowing.BookID = #{bookId}
            </if>
            <if test="state != null">
                and borrowing.state = #{state}
            </if>
    </select>
</mapper>